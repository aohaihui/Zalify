<section id="#{{ section.id }}">
  <div class="giiker-product-basice pc-image" data-cc-animate="fade-in">
    <div class="left-content">
        {{
          section.settings.background_left_image
          | image_url: width: section.settings.background_left_image.width
          | image_tag: height: section.settings.background_left_image.height,
           fetchpriority: 'high', loading: 'lazy', class: 'image-left-tag'
        }}
    </div>
    <div class="right-content">
      {{
        section.settings.background_right_image
        | image_url: width: section.settings.background_right_image.width
        | image_tag: height: section.settings.background_right_image.height,
         fetchpriority: 'high', loading: 'lazy', class: 'image-right-tag'
      }}
      <div class="right-content-title">{{ section.settings.title }}</div>
      <div class="right-content-detail">{{ section.settings.detail }}</div>
    </div>
  </div>
  <div class="mobile-video mb-image" style="cursor: pointer;">
    {% if section.settings.mobile_background_image != blank %}
      {{ section.settings.mobile_background_image | image_url: width: section.settings.mobile_background_image.width | image_tag: height: section.settings.mobile_background_image.height, fetchpriority: 'high', loading: 'lazy', class: 'image-tag', data-cc-animate: 'fade-in' }}
    {% endif %}
  </div>
  <div class="mobile-fixed-image" id="mobile-fixed-image-{{ section.id }}">
    {% if section.settings.mobile_video != blank %}
      <div class="mobile-video-container">
        {{ section.settings.mobile_video | video_tag: loading: 'eager', fetchpriority: 'high', decoding: 'async', class: 'video-tag', playsinline: true, muted: true, loop: true }}
      </div>
    {% endif %}
  </div>
</section>
<style>
  #shopify-section-{{ section.id }}  {
    background: rgba(249, 144, 50, 1);
  }
  #shopify-section-{{ section.id }} .mobile-fixed-image {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 9999;
    align-items: center;
    justify-content: center;
  }
  #shopify-section-{{ section.id }} .mobile-fixed-image.active {
    display: flex;
  }
  #shopify-section-{{ section.id }} .mobile-video-container {
    position: relative;
    width: auto;
    height: auto;
    max-width: 90%;
    max-height: 90%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    box-sizing: border-box;
    z-index: 1;
    pointer-events: none;
  }
  #shopify-section-{{ section.id }} .mobile-video-container .video-tag {
    width: 100%;
    height: auto;
    max-width: 100%;
    max-height: 90vh;
    object-fit: contain;
    pointer-events: auto;
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sectionId = '{{ section.id }}';
    const mobileVideo = document.querySelector('#shopify-section-' + sectionId + ' .mobile-video');
    const mobileFixedImage = document.querySelector('#mobile-fixed-image-' + sectionId);
    const videoTag = mobileFixedImage ? mobileFixedImage.querySelector('.video-tag') : null;
    
    if (mobileVideo && mobileFixedImage) {
      const videoContainer = mobileFixedImage.querySelector('.mobile-video-container');
      
      let scrollPosition = 0;
      
      // 禁用页面滚动
      function disableScroll() {
        // 保存当前滚动位置
        scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
        document.body.style.overflow = 'hidden';
        // document.body.style.position = 'fixed';
        document.body.style.width = '100%';
      }
      
      // 恢复页面滚动
      function enableScroll() {
        document.body.style.overflow = '';
        // document.body.style.position = '';
        document.body.style.width = '';
        // 恢复滚动位置
        // window.scrollTo(0, scrollPosition);
      }
      
      // 点击 mobile-video 显示全屏视频
      mobileVideo.addEventListener('click', function(e) {
        e.stopPropagation();
        mobileFixedImage.classList.add('active');
        disableScroll();
        if (videoTag) {
          videoTag.play();
        }
      });
      
      // 点击 video 外的区域关闭并停止播放
      mobileFixedImage.addEventListener('click', function(e) {
        // 如果点击的是 video 元素本身，不关闭
        if (e.target === videoTag || (videoContainer && videoContainer.contains(e.target))) {
          return;
        }
        // 点击 video 外的区域，关闭并停止播放
        mobileFixedImage.classList.remove('active');
        enableScroll();
        if (videoTag) {
          videoTag.pause();
          videoTag.currentTime = 0;
        }
      });
      
      // 防止点击 video 容器时关闭（使用 stopPropagation）
      if (videoContainer) {
        videoContainer.addEventListener('click', function(e) {
          e.stopPropagation();
        });
      }
      
      // 防止点击 video 元素时关闭
      if (videoTag) {
        videoTag.addEventListener('click', function(e) {
          e.stopPropagation();
        });
      }
      
      // 添加 ESC 键关闭功能
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && mobileFixedImage.classList.contains('active')) {
          mobileFixedImage.classList.remove('active');
          enableScroll();
          if (videoTag) {
            videoTag.pause();
            videoTag.currentTime = 0;
          }
        }
      });
      
      // 防止触摸滚动（移动端）
      mobileFixedImage.addEventListener('touchmove', function(e) {
        e.preventDefault();
      }, { passive: false });
    }
  });
</script>
{% schema %}
{
  "name": "Giiker Product Basice",
  "settings": [
    {
      "type": "image_picker",
      "id": "background_left_image",
      "label": "Background Left Image"
    },
    {
      "type": "image_picker",
      "id": "background_right_image",
      "label": "Background Right Image"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Learn the basics"
    },
    {
      "type": "text",
      "id": "detail",
      "label": "Detail",
      "default": "A step-by-step tutorial on how our smart product makes learning a breeze."
    },
    {
      "type": "video",
      "id": "mobile_video",
      "label": "Mobile Video"
    },
    {
      "type": "image_picker",
      "id": "mobile_background_image",
      "label": "Mobile Background Image"
    }
  ],
  "presets": [
    {
      "name": "Giiker Product Basice"
    }
  ]
}
{% endschema %}