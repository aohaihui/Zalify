<div class="giiker-home-awards-image-container">
  <div class="awards-marquee">
    <div class="awards-marquee-content">
      {% for block in section.blocks %}
        <div class="awards-marquee-item">
          <div class="giiker-home-awards-image-item">
            <div class="giiker-home-awards-image-item-content">
              <div class="giiker-home-awards-image-item-content-image">
                <img src="{{ block.settings.image | image_url: width: block.settings.image.width }}" 
                     alt=""
                     class="image-tag"
                     data-cc-animate="fade-in"
                     loading="lazy"
                     width="{{ block.settings.image.width }}"
                     height="{{ block.settings.image.height }}">
              </div>
            </div>
            <div class="giiker-home-awards-image-item-title">
              {{ block.settings.title }}
            </div>
          </div>
        </div>
      {% endfor %}
      <!-- 复制一份用于无缝循环 -->
      {% for block in section.blocks %}
        <div class="awards-marquee-item">
          <div class="giiker-home-awards-image-item">
            <div class="giiker-home-awards-image-item-content">
              <div class="giiker-home-awards-image-item-content-image">
                <img src="{{ block.settings.image | image_url: width: block.settings.image.width }}" 
                     alt=""
                     class="image-tag"
                     data-cc-animate="fade-in"
                     loading="lazy"
                     width="{{ block.settings.image.width }}"
                     height="{{ block.settings.image.height }}">
              </div>
            </div>
            <div class="giiker-home-awards-image-item-title">
              {{ block.settings.title }}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Giiker Home Awards Image",
  "settings": [

  ],
  "blocks": [
    {
      "type": "awards",
      "name": "Awards",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "richtext",
          "id": "title",
          "label": "Title"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Giiker Home Awards Image"
    }
  ]
}
{% endschema %}


<script>
document.addEventListener('DOMContentLoaded', function() {
  const marqueeElement = document.querySelector('.awards-marquee-content');
  if (!marqueeElement) return;
  
  const items = marqueeElement.querySelectorAll('.awards-marquee-item');
  if (items.length === 0) return;
  
  // 计算原始内容宽度（第一份）
  const originalCount = items.length / 2;
  let originalWidth = 0;
  
  // 获取第一个元素的 margin-right
  const firstItem = items[0];
  const computedStyle = window.getComputedStyle(firstItem);
  const marginRight = parseFloat(computedStyle.marginRight) || 30;
  
  // 计算第一份内容的宽度
  for (let i = 0; i < originalCount; i++) {
    const item = items[i];
    originalWidth += item.offsetWidth + (i < originalCount - 1 ? marginRight : 0);
  }
  
  // 如果内容宽度不够，复制更多份以确保无缝循环
  const containerWidth = marqueeElement.parentElement.offsetWidth;
  const neededCopies = Math.ceil((containerWidth * 2) / originalWidth) + 1;
  
  // 如果当前只有2份（原始+1份复制），需要添加更多
  const currentCopies = items.length / originalCount;
  if (currentCopies < neededCopies) {
    const originalHTML = Array.from(items).slice(0, originalCount).map(item => item.outerHTML).join('');
    const additionalCopies = neededCopies - currentCopies;
    for (let i = 0; i < additionalCopies; i++) {
      marqueeElement.insertAdjacentHTML('beforeend', originalHTML);
    }
  }
  
  // 重新计算总宽度
  const totalWidth = marqueeElement.scrollWidth;
  const halfWidth = totalWidth / 2;
  
  // 设置动画，确保无缝循环
  marqueeElement.style.setProperty('--marquee-width', `-${halfWidth}px`);
  marqueeElement.style.willChange = 'transform';
  
  // 鼠标悬停暂停动画
  marqueeElement.addEventListener('mouseenter', function() {
    this.style.animationPlayState = 'paused';
  });
  
  marqueeElement.addEventListener('mouseleave', function() {
    this.style.animationPlayState = 'running';
  });
  
  // 窗口大小改变时重新计算
  let resizeTimer;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
      const newTotalWidth = marqueeElement.scrollWidth;
      const newHalfWidth = newTotalWidth / 2;
      marqueeElement.style.setProperty('--marquee-width', `-${newHalfWidth}px`);
    }, 250);
  });
});
</script>